{"ast":null,"code":"var _jsxFileName = \"/Users/abhayagarwal/IdeaProjects/UPI-saathi/frontend/src/components/VoiceInterface.js\",\n  _s = $RefreshSig$();\n// src/components/VoiceInterface.js\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useVoice } from '../hooks/useVoice';\nimport { parseVoiceCommand } from '../utils/voiceCommands';\nimport { toast } from 'react-toastify';\nimport { useAccessibility } from '../contexts/AllContexts';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst parseAmount = text => {\n  const match = text.match(/(\\d+(\\.\\d+)?)/);\n  if (!match) return null;\n  return parseFloat(match[1]);\n};\nconst normalizeRecipient = text => {\n  const cleaned = text.replace(/send money to/i, '').trim();\n  if (!cleaned) return '';\n  if (cleaned.includes('@')) return cleaned;\n  return `${cleaned.replace(/\\s+/g, '').toLowerCase()}@upi`;\n};\nconst VoiceInterface = ({\n  onAction\n}) => {\n  _s();\n  const {\n    settings,\n    speak\n  } = useAccessibility();\n  const [flow, setFlow] = useState({\n    step: 'idle',\n    recipientUpiId: '',\n    amount: ''\n  });\n  const lastPromptRef = useRef('');\n  const autoStartedRef = useRef(false);\n  const {\n    listening,\n    startListening,\n    stopListening,\n    error\n  } = useVoice({\n    onCommand: text => {\n      const transcript = text.trim().toLowerCase();\n      if (transcript.includes('cancel') && flow.step !== 'idle') {\n        setFlow({\n          step: 'idle',\n          recipientUpiId: '',\n          amount: ''\n        });\n        toast.info('Cancelled voice transaction');\n        if (settings.enableVoiceNavigation) {\n          speak('Cancelled voice transaction.');\n        }\n        return;\n      }\n      if (transcript.includes('repeat') && lastPromptRef.current) {\n        if (settings.enableVoiceNavigation) {\n          speak(lastPromptRef.current);\n        }\n        return;\n      }\n      if (transcript.includes('send money')) {\n        if (transcript.includes('to')) {\n          const recipientUpiId = normalizeRecipient(transcript);\n          if (!recipientUpiId) {\n            lastPromptRef.current = 'Please say the recipient UPI ID.';\n            speak(lastPromptRef.current);\n            setFlow({\n              step: 'awaitingRecipient',\n              recipientUpiId: '',\n              amount: ''\n            });\n            return;\n          }\n          const nextPrompt = 'How much would you like to send?';\n          lastPromptRef.current = nextPrompt;\n          if (settings.enableVoiceNavigation) {\n            speak(nextPrompt);\n          }\n          setFlow({\n            step: 'awaitingAmount',\n            recipientUpiId,\n            amount: ''\n          });\n          return;\n        }\n        const prompt = 'Whom would you like to send money to?';\n        lastPromptRef.current = prompt;\n        if (settings.enableVoiceNavigation) {\n          speak(prompt);\n        }\n        setFlow({\n          step: 'awaitingRecipient',\n          recipientUpiId: '',\n          amount: ''\n        });\n        return;\n      }\n      if (flow.step === 'awaitingRecipient') {\n        const recipientUpiId = normalizeRecipient(transcript);\n        const prompt = 'How much would you like to send?';\n        lastPromptRef.current = prompt;\n        if (settings.enableVoiceNavigation) {\n          speak(prompt);\n        }\n        setFlow({\n          step: 'awaitingAmount',\n          recipientUpiId,\n          amount: ''\n        });\n        return;\n      }\n      if (flow.step === 'awaitingAmount') {\n        const amount = parseAmount(transcript);\n        if (!amount) {\n          const prompt = 'Please say the amount in rupees.';\n          lastPromptRef.current = prompt;\n          if (settings.enableVoiceNavigation) {\n            speak(prompt);\n          }\n          return;\n        }\n        const draft = {\n          action: 'VOICE_SEND_DRAFT',\n          recipientUpiId: flow.recipientUpiId,\n          amount\n        };\n        setFlow({\n          step: 'idle',\n          recipientUpiId: '',\n          amount: ''\n        });\n        onAction === null || onAction === void 0 ? void 0 : onAction(draft);\n        return;\n      }\n      const command = parseVoiceCommand(transcript);\n      console.log('ðŸ§  Command:', command);\n      if (command.action === 'UNKNOWN') {\n        toast.info('Sorry, I did not understand that.');\n        return;\n      }\n      onAction === null || onAction === void 0 ? void 0 : onAction(command);\n    }\n  });\n  useEffect(() => {\n    if (!settings.enableVoiceNavigation) return;\n    if (autoStartedRef.current || listening) return;\n    try {\n      startListening();\n      autoStartedRef.current = true;\n    } catch (e) {\n      // Browser may block without user gesture.\n    }\n  }, [listening, settings.enableVoiceNavigation, startListening]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn btn-secondary\",\n      onClick: listening ? stopListening : startListening,\n      children: listening ? 'ðŸ›‘ Stop Voice' : 'ðŸŽ¤ Start Voice'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(\"p\", {\n      style: {\n        color: 'red'\n      },\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 133,\n    columnNumber: 5\n  }, this);\n};\n_s(VoiceInterface, \"UwcCNS7+nnDTckYcifHOSjxWM0Q=\", false, function () {\n  return [useAccessibility, useVoice];\n});\n_c = VoiceInterface;\nexport default VoiceInterface;\nvar _c;\n$RefreshReg$(_c, \"VoiceInterface\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useVoice","parseVoiceCommand","toast","useAccessibility","jsxDEV","_jsxDEV","parseAmount","text","match","parseFloat","normalizeRecipient","cleaned","replace","trim","includes","toLowerCase","VoiceInterface","onAction","_s","settings","speak","flow","setFlow","step","recipientUpiId","amount","lastPromptRef","autoStartedRef","listening","startListening","stopListening","error","onCommand","transcript","info","enableVoiceNavigation","current","nextPrompt","prompt","draft","action","command","console","log","e","children","className","onClick","fileName","_jsxFileName","lineNumber","columnNumber","style","color","_c","$RefreshReg$"],"sources":["/Users/abhayagarwal/IdeaProjects/UPI-saathi/frontend/src/components/VoiceInterface.js"],"sourcesContent":["// src/components/VoiceInterface.js\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useVoice } from '../hooks/useVoice';\nimport { parseVoiceCommand } from '../utils/voiceCommands';\nimport { toast } from 'react-toastify';\nimport { useAccessibility } from '../contexts/AllContexts';\n\nconst parseAmount = (text) => {\n  const match = text.match(/(\\d+(\\.\\d+)?)/);\n  if (!match) return null;\n  return parseFloat(match[1]);\n};\n\nconst normalizeRecipient = (text) => {\n  const cleaned = text.replace(/send money to/i, '').trim();\n  if (!cleaned) return '';\n  if (cleaned.includes('@')) return cleaned;\n  return `${cleaned.replace(/\\s+/g, '').toLowerCase()}@upi`;\n};\n\nconst VoiceInterface = ({ onAction }) => {\n  const { settings, speak } = useAccessibility();\n  const [flow, setFlow] = useState({\n    step: 'idle',\n    recipientUpiId: '',\n    amount: ''\n  });\n  const lastPromptRef = useRef('');\n  const autoStartedRef = useRef(false);\n\n  const { listening, startListening, stopListening, error } = useVoice({\n    onCommand: (text) => {\n      const transcript = text.trim().toLowerCase();\n\n      if (transcript.includes('cancel') && flow.step !== 'idle') {\n        setFlow({ step: 'idle', recipientUpiId: '', amount: '' });\n        toast.info('Cancelled voice transaction');\n        if (settings.enableVoiceNavigation) {\n          speak('Cancelled voice transaction.');\n        }\n        return;\n      }\n\n      if (transcript.includes('repeat') && lastPromptRef.current) {\n        if (settings.enableVoiceNavigation) {\n          speak(lastPromptRef.current);\n        }\n        return;\n      }\n\n      if (transcript.includes('send money')) {\n        if (transcript.includes('to')) {\n          const recipientUpiId = normalizeRecipient(transcript);\n          if (!recipientUpiId) {\n            lastPromptRef.current = 'Please say the recipient UPI ID.';\n            speak(lastPromptRef.current);\n            setFlow({ step: 'awaitingRecipient', recipientUpiId: '', amount: '' });\n            return;\n          }\n          const nextPrompt = 'How much would you like to send?';\n          lastPromptRef.current = nextPrompt;\n          if (settings.enableVoiceNavigation) {\n            speak(nextPrompt);\n          }\n          setFlow({ step: 'awaitingAmount', recipientUpiId, amount: '' });\n          return;\n        }\n\n        const prompt = 'Whom would you like to send money to?';\n        lastPromptRef.current = prompt;\n        if (settings.enableVoiceNavigation) {\n          speak(prompt);\n        }\n        setFlow({ step: 'awaitingRecipient', recipientUpiId: '', amount: '' });\n        return;\n      }\n\n      if (flow.step === 'awaitingRecipient') {\n        const recipientUpiId = normalizeRecipient(transcript);\n        const prompt = 'How much would you like to send?';\n        lastPromptRef.current = prompt;\n        if (settings.enableVoiceNavigation) {\n          speak(prompt);\n        }\n        setFlow({ step: 'awaitingAmount', recipientUpiId, amount: '' });\n        return;\n      }\n\n      if (flow.step === 'awaitingAmount') {\n        const amount = parseAmount(transcript);\n        if (!amount) {\n          const prompt = 'Please say the amount in rupees.';\n          lastPromptRef.current = prompt;\n          if (settings.enableVoiceNavigation) {\n            speak(prompt);\n          }\n          return;\n        }\n        const draft = {\n          action: 'VOICE_SEND_DRAFT',\n          recipientUpiId: flow.recipientUpiId,\n          amount\n        };\n        setFlow({ step: 'idle', recipientUpiId: '', amount: '' });\n        onAction?.(draft);\n        return;\n      }\n\n      const command = parseVoiceCommand(transcript);\n      console.log('ðŸ§  Command:', command);\n\n      if (command.action === 'UNKNOWN') {\n        toast.info('Sorry, I did not understand that.');\n        return;\n      }\n\n      onAction?.(command);\n    }\n  });\n\n  useEffect(() => {\n    if (!settings.enableVoiceNavigation) return;\n    if (autoStartedRef.current || listening) return;\n    try {\n      startListening();\n      autoStartedRef.current = true;\n    } catch (e) {\n      // Browser may block without user gesture.\n    }\n  }, [listening, settings.enableVoiceNavigation, startListening]);\n\n  return (\n    <div>\n      <button className=\"btn btn-secondary\" onClick={listening ? stopListening : startListening}>\n        {listening ? 'ðŸ›‘ Stop Voice' : 'ðŸŽ¤ Start Voice'}\n      </button>\n\n      {error && <p style={{ color: 'red' }}>{error}</p>}\n    </div>\n  );\n};\n\nexport default VoiceInterface;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}